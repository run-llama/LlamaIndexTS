---
title: Define workflows using natural language  
---

When working with Workflows, you have to write code to handle an event in the workflow. 
Often, the logic of the handler is not too complex so that it can be expressed using natural language and executed by an LLM.  
Besides the instructions, we just need the expected result event of the step, possible tool calls and optionally other events that can be emitted.  

## Usage

Let's take an example:

Assume that our workflow has two steps:
```typescript
const PlanEventSchema = z.object({
  userInput: z.string(),
});
const ExecutionEventSchema = z.object({
  actions: z.array(z.string()),
});

const planEvent = zodEvent<PlanEventSchema>();
const executionEvent = zodEvent<ExecutionEventSchema>();
```

Here is the normal way to handle the plan event in the workflow:
  ```typescript
  myWorkflow.handle([planEvent], async ({ userInput }) => {
    // You often request LLM to produce a structure format
    const prompt = `You are a helpful assistant, your task is to produce a plan to resolve the user input: ${userInput}`;
    const response = await llm.complete({ prompt });

    // You then parse the plan into a structure format
    const plan = ...;

    // Check if the plan is in a valid format
    // ...format validation...

    // Return the plan for the next workflow step to handle
    return executionEvent.with({ plan });
  });
  ```

Instead, you can just use the `handleWithAgent` function to create an agent and guide it to handle the step.

It only requires two parameters:
- `instructions`: A prompt to guide the agent to handle the step
- `result`: The output event of this step that the agent should return

Then you will have a simple code to handle the step:
```typescript
myWorkflow.handle([planEvent], handleWithAgent({
  instructions: `Produce a plan made up of a list of actions to resolve the user input.`,
  result: executionEvent,
}));
```

For advanced usage, you can add more functionality to the agent by using:
- `events`: A list of additional events that the agent can emit to the workflow. E.g., your agent can emit a `ui` event to update the UI during the execution.
- `tools`: A list of tools that the agent can use to handle the step. E.g., your agent can use a `search` tool to search the web.

**Note**: The `handleWithAgent` requires that the event is created by the `zodEvent` function passing the zod schema as an argument. The agent needs the schema of the event data to correctly generate events.  
